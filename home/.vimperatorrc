" 初期化
set all&
nmapclear
vmapclear
imapclear
cmapclear

js<<EOM
if(liberator.has("MacUnix")) {
  liberator.execute('"editor=/Applications/MacVim.app/Contents/MacOS/MacVim -f --remote-tab-silent"');
} else {
  liberator.execute('"editor=~/vim73-kaoriya-win64/gvim.exe -f --remote-tab-silent"');
}
EOM

" set defsearch=g
" set complete=lS
set complete=l
" list:longestにすると:openの時2回Tabを打たないといけないので面倒だった
" set wildmode=list:longest,full
set wildmode=list:full
" [wildoptionsをトグルするmap - YKMbPP](http://d.hatena.ne.jp/ykmbpp/20090412/1239513076)

set nextpattern=次へ,\bnext,^>$,^(>>|»)$,^(>|»),(>|»)$,\bmore\b
set previouspattern=前へ,\bprev|previous\b,^<$,^(<<|«)$,^(<|«),(<|«)$

" hintchars
set hintchars=asdfghjklqwertyuiopzxcvbnm1234567890
js<<EOM
var fontFamily;
if(liberator.has("MacUnix")) {
  fontFamily = 'Monaco';
} else {
  fontFamily = 'Consolas';
}
liberator.execute('highlight Hint font-size:14px; color: white; background: red; border-width: 0px; border-style: solid; padding: 0px 1px 0px 1px; font-family: ' + fontFamily);
EOM

" テキストボックスにフォーカスさせない
" set focuscontent

" mapping {{{1
" ============================================================================
let mapleader = ';'
" Emacs like key bindings {{{2
cnoremap <C-p> <UP>
cnoremap <C-n> <DOWN>
cnoremap <C-f> <Right>
cnoremap <C-b> <Left>
cnoremap <A-f> <C-Right>
cnoremap <A-b> <C-Left>
cnoremap <A-d> <C-Del>
cnoremap <C-i> <Tab>

inoremap <C-f> <Right>
inoremap <C-b> <Left>
inoremap <A-f> <C-Right>
inoremap <A-b> <C-Left>
inoremap <A-d> <C-Del>
" inoremap <C-u> <S-Home><BS>

inoremap <C-p> <Up>
inoremap <C-n> <down>
" }}}

nnoremap d D
nnoremap D d
nnoremap <Esc><Esc> :set hlsearch<CR>
noremap <C-h> gT
noremap <C-l> gt
noremap <C-j> :tabmove -1<CR>
noremap <C-k> :tabmove +1<CR>

" 選択した部分をデフォルトの検索エンジンでサーチ
noremap gxx cvy<Esc><Esc>P
" alcでサーチ <S-Insert>で貼り付け出来てない
noremap gxa cvy:tabopen<Space>http://eow.alc.co.jp/search?q=<C-Insert>
" Yahoo!ファイナンスでサーチ
noremap gxf cvy:tabopen<Space>http://info.finance.yahoo.co.jp/search/?query=<S-Insert><CR>

noremap ,B :bmarks<Space>
noremap ,h :history<Space>
noremap ,ps :panorama switch<Space>

nnoremap <Leader>vr :execute 'source ' + io.getRCFile().target<CR>:echo '.vimperatorrc is loaded'<CR>
nnoremap ZZ :restart<CR>

" qmark {{{1
" ============================================================================
qmark c https://www.google.com/calendar/
qmark f https://www.facebook.com/
qmark F http://finance.yahoo.co.jp/
qmark g https://mail.google.com/
qmark n http://www.nicovideo.jp/
qmark q http://qiita.com/
qmark t https://twitter.com/

" bookmarklet {{{1
" ============================================================================
command! -nargs=0 -description="Facebook Object Debugger" bkfbdebug open javascript:(function(){var%20l=encodeURIComponent(location.href);location.href='https://developers.facebook.com/tools/debug/og/object?q='+l;})();
" }}}

" コマンドモード開始時に自動的にIMEをOFFにする
" http://vimperator.g.hatena.ne.jp/teramako/20090311/1236776437
style! -name=commandline-ime chrome://* #liberator-commandline-command input {ime-mode: inactive;}

" migemo-hint.js
" set hintmatching=custom

" hatena bookmark {{{1
" ============================================================================
" https://github.com/hatena/hatena-bookmark-xul/wiki/Vimperator-%E3%81%A7%E3%81%AF%E3%81%A6%E3%81%AA%E3%83%96%E3%83%83%E3%82%AF%E3%83%9E%E3%83%BC%E3%82%AF%E6%8B%A1%E5%BC%B5%E3%82%92%E4%BD%BF%E3%81%86
javascript <<EOF
// キーボードショートカットの指定
// 空(null)を指定すれば hints や nnoremap を上書きしなくなる
//    (注: 現バージョンではデフォルト値で上書きされてます。将来修正予定です)
liberator.globalVariables.hBookmark_shortcuts = {
    hintsAdd     : 'c',
    hintsComment : 'C',
    add          : ['C'],
    comment      : [';c'],
};
EOF
javascript if (typeof hBookmark != 'undefined') liberator.loadScript('chrome://hatenabookmark/content/vimperator/plugin/hatenabookmark.js', {__proto__: this});
set complete+=H

" plugin_loader {{{1
" ============================================================================
let g:plugin_loader_roots = "~/git/vimperator-plugins"
let g:plugin_loader_plugins = "_libly,copy,feedSomeKeys_3,prevent-pseudo-domain,migemo_completion"
" forcefocuscontentはタイミングが遅いのでやめる

" copy.js {{{1
" ============================================================================
" http://chroju89.hatenablog.jp/entry/2014/02/09/102914
" titleないときどうにかしたい
javascript <<EOM
liberator.globalVariables.copy_templates = [
    { label: 'title',     value: '%TITLE%'},
    { label: 'plain',     value: '%TITLE%\n%URL%'},
    { label: 'markdown',  value: '[%TITLE%](%URL%)'},
    { label: 'anchor',    value: '<a href="%URL%">%TITLE%</a>'},
    { label: 'selanchor', value: '<a href="%URL%" title="%TITLE%">%SEL%</a>' },
];
EOM

" mapを上で設定すると不安定なので、ここで設定
nnoremap ,yt :copy title<CR>
nnoremap ,yp :copy plain<CR>
nnoremap ,ym :copy markdown<CR>
nnoremap ,ya :copy anchor<CR>

" feedsomekeys_3.js {{{1
" ============================================================================
" feedSomeKeys_3.jsで無効化するキーを設定する
" http://vimperator.g.hatena.ne.jp/nokturnalmortum/20100302/1267531921
" URLの正規表現を「"」でなくて、「'」で括るのが密かなポイントです。
" (「"」の場合、エスケープを \\ のように二重にしなくてはいけなくなります。)

command! -nargs=+ lazy autocmd VimperatorEnter .* <args>
" ?でショートカットキーを見れるようにする
lazy fmaps -u='.*' ?
" gmailでnとj、pとjを入れ替える。
lazy fmaps -u='mail\.google\.com/mail' n,j p,k
" うまくいかない
lazy fmaps -u='github\.com' p,k f,t w s ? <Esc>

" ignorekeysはvimperatorで標準で出来る設定
" http://vimperator.g.hatena.ne.jp/teramako/20120527/1338101792
" feedSomeKeys_3.jsとは反対ですべてのキーを無効化して、vimperatorで使うキーを設定する
" ignorekeys add github\\.com  -except F,T,b,c,d,f,g,j,k,o,t,:,<C-l>,<C-h>,<C-f>,<C-b>
" ignorekeys add twitter\\.com -except F,T,b,c,d,f,g,j,k,o,t,:,<C-l>,<C-h>,<C-f>,<C-b>
" ignorekeysがなかった頃
" autocmd LocationChange .* js modes.passAllKeys = /google\.co\.jp/.test(buffer.URL)

" config {{{1
" ============================================================================
" frecency {{{
" ----------------------------------------------------------------------------
" set! places.frecency.linkVisitBonus=98
" set! places.frecency.typedVisitBonus=15
" set! places.frecency.bookmarkVisitBonus=1
" set! places.frecency.embedVisitBonus=0
" set! places.frecency.permRedirectVisitBonus=13
" set! places.frecency.tempRedirectVisitBonus=1
" set! places.frecency.downloadVisitBonus=0
"
" set! places.frecency.firstBucketWeight=94
" set! places.frecency.secondBucketWeight=33
" set! places.frecency.thirdBucketWeight=7
" set! places.frecency.fourthBucketWeight=6
" set! places.frecency.defaultBucketWeight=3
" }}}
" }}}

javascript <<EOF
// [liberator.io - Vimperator](http://seesaawiki.jp/w/shin_yan/d/liberator.io#content_22)
if(io.File('~/.vimperatorrc.local').exists()){
    io.source('~/.vimperatorrc.local', false);
}
EOF

" vimperatorを自分でビルドしたいとき
"   cd **SOMEWHERE**
"   git clone https://github.com/vimperator/vimperator-labs/
"   cd vimperator-labs
"   git checkout 3.8.3-a3
"   make
"   # to install the created `xpi` file into your firefox type the below into its `command line`
"   :open file:///**SOMEWHERE**/vimperator-labs/downloads/vimperator-3.8.3.xpi

" vim: set ft=vimperator:
