# コマンドの存在チェック {{{1
# @see コマンドの存在チェックはwhichよりhashの方が良いかも→いやtypeが最強
#      http://qiita.com/kawaz/items/1b61ee2dd4d1acc7cc94
function command_exists {
  hash "$1" 2>/dev/null;
}

# hosts用の設定の出力 {{{1
function hosts {
    host $(hostname) | awk '{print $4"	#"$1}'
}

# PATHの設定 {{{1
# ============================================================================
# CentOS 6.3の/etc/profileにあるPATHを追加する関数
pathmunge () {
    case ":${PATH}:" in
        *:"$1":*)
            ;;
        *)
            if [ "$2" = "after" ] ; then
                PATH=$PATH:$1
            else
                PATH=$1:$PATH
            fi
    esac
}

# 実行ファイルがあるディレクトリに再帰的にPATHを通す
pathmungeR () {
    if [ -d $1 ]; then
        for i in `find -L $1 -type d \( -name .git -o -name .svn -o -name .hg \) -prune -o -type f -perm -u+x -exec dirname {} \; | uniq`
        do
            pathmunge $i $2
        done
    fi
}

# シェルスクリプトなどを置くディレクトリ
pathmunge ${HOME}/bin
# makeで作った実行ファイルなどを置くディレクトリ
# MacVimで!でコマンド実行をするとPATHの先頭に /etc/pathsとMacVimのPATHを追加するようなので
# さらに先頭に$HOME/local/binを追加する
# pathmungeだと、すでにPATHにあるため追加できないのでexportで追加
export PATH=$HOME/local/bin:$PATH

pathmunge ${HOME}/.composer/vendor/bin

# neobundleで管理するスクリプト
pathmungeR ~/.vim/fetchBundle

pathmungeR ${HOME}/script/common
# 正規のコマンドがないときに使う仮のコマンドを置くディレクトリ
pathmungeR $HOME/script/pseudo after


if [[ `uname` = CYGWIN* ]]; then
    # Cygwin用のコマンドを置くディレクトリ
    pathmungeR $HOME/script/cygwin
elif [[ $OSTYPE == darwin* ]]; then
    # Mac用のコマンドを置くディレクトリ
    pathmungeR $HOME/script/mac

    export PATH="/usr/local/sbin:$PATH"

    # coreutils
    export PATH="/usr/local/opt/coreutils/libexec/gnubin:$PATH"
    export MANPATH="/usr/local/opt/coreutils/libexec/gnuman:$MANPATH"

    # gnu-sed
    export PATH="/usr/local/opt/gnu-sed/libexec/gnubin:$PATH"
    export MANPATH="/usr/local/opt/gnu-sed/libexec/gnuman:$MANPATH"

    # wine
    if [ -d ~/Applications/PlayOnMac.app/Contents/Resources/unix/wine/bin ]; then
        pathmunge ~/Applications/PlayOnMac.app/Contents/Resources/unix/wine/bin after
    fi
fi


# script_dir=$HOME/git/tmsanrinsha/dotfiles/script
# # シェルスクリプトなどを置くディレクトリ
# pathmungeR ${script_dir}/common
# # 正規のコマンドがないときに使う仮のコマンドを置くディレクトリ
# pathmungeR ${script_dir}/pseudo after
# # Cygwin用のコマンドを置くディレクトリ
# if [[ `uname` = CYGWIN* ]]; then
#     pathmungeR ${script_dir}/cygwin
# fi

if [[ `uname` = Darwin ]]; then
    # ruby
    export PATH=/usr/local/opt/ruby/bin:$PATH
fi

# Environment Variables {{{1
# ============================================================================
if [ -x /Applications/MacVim.app/Contents/MacOS/Vim ]; then
    export EDITOR='/Applications/MacVim.app/Contents/MacOS/Vim'
else
    export EDITOR='vim'
fi
export SRC_ROOT=$HOME/src
export PAGER=less

# lessのオプションの設定
# i: 検索をsmartcassにする
# R: カラーシーケンスを色に変換して表示する
export LESS='-iR'

# export PAGER=/usr/local/share/vim/vim73/macros/less.sh
# export LESSOPEN="| /usr/bin/lesspipe.sh %s"
# export LESSCLOSE="/usr/bin/lesspipe.sh %s %s"

export XDG_CONFIG_HOME="$HOME/.config"
export XDG_CACHE_HOME="$HOME/.cache"

## Java
export JAVA_TOOL_OPTIONS=-Dfile.encoding=UTF-8

## R lang
export R_ENVIRON_USER="$XDG_CONFIG_HOME/R/Renviron"
test -d $XDG_CACHE_HOME/R || mkdir -p $XDG_CACHE_HOME/R
export R_HISTFILE="$XDG_CACHE_HOME/R/Rhistory"
export R_HISTSIZE="5000"

# alias {{{1
# ============================================================================
alias l='ls'
alias ll='ls -l'
# . ..以外の.で始まるファイルも表示
alias la='ls -A'
alias lla='ls -la'

alias ...='cd ../..'
alias ....='cd ../../..'
alias .....='cd ../../../..'
alias ......='cd ../../../../..'
alias .......='cd ../../../../../..'

alias egrep='egrep --color=auto'
if [ `uname` = FreeBSD ];then
    alias find='find -E'
fi

alias pg='ps aux | grep -v grep | grep'
alias pe='ps aux | egrep'
alias pk='pkill -f'

# tree {{{2
# ----------------------------------------------------------------------------
# -F:ディレクトリなら/をつけるなど
# -C:color
# -l:ディレクトリのシンボリックリンクを追う
alias tree='tree -FCl'

# vim {{{2
# ----------------------------------------------------------------------------
if [ -d /Applications/MacVim.app/Contents/MacOS ]; then
    pathmunge /Applications/MacVim.app/Contents/MacOS
fi

alias vi='vim'
alias view='vim -R' # readonlyで開く
if [ -x $HOME/local/share/vim/vim73/macros/less.sh ]; then
    alias vl="$HOME/local/share/vim/vim73/macros/less.sh"
fi
alias vis="vim -S ~/.cache/vim/session.vim"
alias vsh="vim -c 'VimShell'"
alias vf="vim -c 'VimFiler'"
alias neobundle_last_updaate_list="find ~/.vim/bundle -type d -maxdepth 1 -mindepth 1 ! -name .neobundle | xargs -I{} sh -c 'cd {} && git log --pretty=format:\"%ad \" --date=short -n 1 && pwd' | sort"

# git {{{2
# ------------------------------------------------------------------------------
alias gal='alias | grep git'
alias ga='git add'
alias gb='git branch'
alias gci='git commit'
alias gco='git checkout'
alias gd='git diff'
alias gdn='git diff --no-ext-diff'
alias gdr='git diff remotes/origin/master'
alias gi='git init'
alias gl='git hist -n 10'
alias gla='git hist'
alias glv='git log | vim -R -'
alias gm='git merge'
alias gpl='git pull'
alias gplr='git pull --rebase origin master'
alias gps='git push'
alias gmt='git mergetool'
alias grbi='git rebase -i'
alias grv='git remote -v'
alias gs='git status'

# gitのルートディレクトリに移動
alias cdt='cd `git rev-parse --show-toplevel`'

# tail {{{2
# ----------------------------------------------------------------------------
if [[ "$OSTYPE" == darwin* ]]; then
  alias taa='tail -f /var/log/apache2/access_log'
  alias tae='tail -f /var/log/apache2/error_log'
fi
# }}}

alias cdg='ghq look'

alias phpunit='phpunit.sh --colors=auto'

# svnとtreeの文字化け対策
alias lcc="export LC_CTYPE='C'"
# 日本語入力用
alias lcu="export LC_CTYPE='ja_JP.UTF-8'"

alias sr="exec $SHELL -l"

# カレントディレクトリ以下のファイルに書き込み権限を与える
alias smw='find . -type f -print0 | xargs -0 -I{} sudo chmod a+w {}'
# カレントディレクトリのファイル名をFull Pathで表示
alias fp='find `pwd` -maxdepth 1 -mindepth 1'
# ファイルを解凍するシェルスクリプト
alias dc='decomp.sh'
# find $1 type f -print0 | xargs -0 egrep --color=auto $2
alias fxg='fxg.sh'
# Linuxのバージョンを表示するコマンド
# http://blog.layer8.sh/ja/2011/12/23/linux%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%84os%E5%90%8D%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89linux/
alias version='cat /etc/`ls /etc -F | grep "release$\|version$"`'

alias decode_html_entity='php -r '\''echo html_entity_decode($argv[1], ENT_NOQUOTES, "UTF-8")."\n";'\';
alias jqq='python -m json.tool | python -c "import re,sys;chr=__builtins__.__dict__.get(\"unichr\", chr);sys.stdout.write(re.sub(r\"\\\\u[0-9a-f]{4}\", lambda x: unichr(int(\"0x\" + x.group(0)[2:], 16)), sys.stdin.read()))"'
# }}}
# Go language {{{1
# ============================================================================
export GOPATH=$HOME/.go
pathmunge $GOPATH/bin
# }}}

if [ -f ~/.zashenv.local ]; then
    . ~/.zashenv.local
fi

# vim:filetype=sh
